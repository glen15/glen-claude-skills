---
description: 요구사항 재확인, 리스크 평가, 단계별 구현 계획 생성. 코드 작성 전 반드시 사용자 확인 대기.
---

# Plan 커맨드

이 커맨드는 **planner** 에이전트를 호출하여 코드 작성 전 종합적인 구현 계획을 생성합니다.

## 이 커맨드가 하는 일

1. **요구사항 재확인** - 구축할 내용 명확화
2. **리스크 식별** - 잠재적 이슈 및 차단 요소 표면화
3. **단계 계획 생성** - 구현을 단계별로 분해
4. **확인 대기** - 진행 전 반드시 사용자 승인 필요

## 사용 시점

다음 경우에 `/plan` 사용:
- 새로운 기능 시작
- 중요한 아키텍처 변경
- 복잡한 리팩토링 작업
- 여러 파일/컴포넌트가 영향을 받는 경우
- 요구사항이 불명확하거나 모호한 경우

## 작동 방식

planner 에이전트가 수행하는 작업:

1. **요청 분석** 및 요구사항을 명확한 용어로 재확인
2. **단계별 분해** - 구체적이고 실행 가능한 단계로
3. **의존성 식별** - 컴포넌트 간 관계
4. **리스크 평가** 및 잠재적 차단 요소
5. **복잡도 추정** (High/Medium/Low)
6. **계획 제시** 및 명시적 확인 대기

## 사용 예시

```
User: /plan 마켓이 해결될 때 실시간 알림 기능 추가 필요

Agent (planner):
# 구현 계획: 실시간 마켓 해결 알림

## 요구사항 재확인
- 사용자가 관심 있는 마켓이 해결될 때 알림 전송
- 여러 알림 채널 지원 (인앱, 이메일, 웹훅)
- 알림이 안정적으로 전달되도록 보장
- 마켓 결과 및 사용자 포지션 결과 포함

## 구현 단계

### 1단계: 데이터베이스 스키마
- notifications 테이블 추가: id, user_id, market_id, type, status, created_at
- user_notification_preferences 테이블 추가
- 성능을 위해 user_id, market_id에 인덱스 생성

### 2단계: 알림 서비스
- lib/notifications.ts에 알림 서비스 생성
- BullMQ/Redis를 사용한 알림 큐 구현
- 실패 전달에 대한 재시도 로직 추가
- 알림 템플릿 생성

### 3단계: 통합 지점
- 마켓 해결 로직에 연결 (상태가 "resolved"로 변경될 때)
- 마켓에 포지션이 있는 모든 사용자 쿼리
- 각 사용자에 대한 알림 큐에 추가

### 4단계: 프론트엔드 컴포넌트
- 헤더에 NotificationBell 컴포넌트 생성
- NotificationList 모달 추가
- Supabase 구독을 통한 실시간 업데이트 구현
- 알림 설정 페이지 추가

## 의존성
- Redis (큐용)
- 이메일 서비스 (SendGrid/Resend)
- Supabase 실시간 구독

## 리스크
- HIGH: 이메일 전달성 (SPF/DKIM 필요)
- MEDIUM: 마켓당 1000+ 사용자 시 성능
- MEDIUM: 마켓이 자주 해결되는 경우 알림 스팸
- LOW: 실시간 구독 오버헤드

## 예상 복잡도: MEDIUM

**확인 대기 중**: 이 계획으로 진행할까요? (yes/no/modify)
```

## 중요 사항

**핵심**: planner 에이전트는 "yes" 또는 "proceed" 등의 긍정적 응답으로 명시적 확인을 받기 전까지 **코드를 작성하지 않습니다**.

변경을 원하면 다음과 같이 응답:
- "modify: [변경 내용]"
- "다른 접근법: [대안]"
- "2단계 건너뛰고 3단계 먼저"

## 다른 커맨드와의 통합

계획 후:
- `/tdd`를 사용하여 테스트 주도 개발로 구현
- `/build-and-fix`를 사용하여 빌드 오류 발생 시
- `/code-review`를 사용하여 완료된 구현 검토

## 관련 에이전트

이 커맨드는 다음 위치의 `planner` 에이전트를 호출:
`~/.claude/agents/planner.md`
